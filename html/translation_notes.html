<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="prev" title="Suggest an addition" href="suggest.html" />

    <meta name="generator" content="sphinx-4.3.2, furo 2021.11.23"/>
        <title>Notes on translations - using gettext - friendly-traceback 0.5.46</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=7f0192ddeb2adecfbaa87ffbcf67d16358b30bc1" />
    <link rel="stylesheet" type="text/css" href="_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=0af69da206d614734f649b27d4cdc2dd6c31f41d" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    
    


<style>
  body {
    --color-code-background: #FFFFFF;
  --color-code-foreground: #101010;
  
  }
  body[data-theme="dark"] {
    --color-code-background: #101010;
  --color-code-foreground: #F4F0EC;
  
  }
  @media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
      --color-code-background: #101010;
  --color-code-foreground: #F4F0EC;
  
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" />
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">friendly-traceback 0.5.46</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand centered" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="_static/friendly_logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">friendly-traceback 0.5.46</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Begin here</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="beginner.html">Useful information for beginners</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Getting Friendly</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Basic usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage_adv.html">Other details for advanced users</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">friendly console</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="repl.html">Console basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="why.html">why()</a></li>
<li class="toctree-l1"><a class="reference internal" href="what.html">what()</a></li>
<li class="toctree-l1"><a class="reference internal" href="where.html">where()</a></li>
<li class="toctree-l1"><a class="reference internal" href="explain.html">explain()</a></li>
<li class="toctree-l1"><a class="reference internal" href="www.html">www()</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">history() and back()</a></li>
<li class="toctree-l1"><a class="reference internal" href="friendly_object.html">Friendly object</a></li>
<li class="toctree-l1"><a class="reference internal" href="repl_api.html">Everything about the friendly console</a></li>
<li class="toctree-l1"><a class="reference internal" href="about_warnings.html">One last thing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Why import *?</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="import_all.html">Why <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">*</span></code>?</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">IDLE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="idle.html">About IDLE</a></li>
<li class="toctree-l1"><a class="reference internal" href="idle_repl.html">IDLE’s shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="idle_run.html">IDLE: using the editor</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Mu</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="mu_about.html">About Mu</a></li>
<li class="toctree-l1"><a class="reference internal" href="mu_install.html">Using with Mu: installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="mu_repl.html">Mu’s REPL</a></li>
<li class="toctree-l1"><a class="reference internal" href="mu_run.html">Mu: executing a program</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Other consoles</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="pyrepl.html">Using another REPL</a></li>
<li class="toctree-l1"><a class="reference internal" href="vs_code_repl.html">Visual Studio Code’s terminal</a></li>
<li class="toctree-l1"><a class="reference internal" href="ipython_repl.html">IPython’s console</a></li>
<li class="toctree-l1"><a class="reference internal" href="other_repl.html">Other repl</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Editors and Notebooks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install_thonny.html">Information for Thonny</a></li>
<li class="toctree-l1"><a class="reference internal" href="editor.html">Using with an editor or IDE</a></li>
<li class="toctree-l1"><a class="reference internal" href="jupyter.html">Jupyter notebooks and JupyterLab</a></li>
<li class="toctree-l1"><a class="reference internal" href="vs_code.html">Visual Studio Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="colab.html">Google’s colab</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Thoughts on design</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="design.html">Some thoughts on the design of friendly</a></li>
<li class="toctree-l1"><a class="reference internal" href="themes.html">Themes, Styles, and Colours</a></li>
<li class="toctree-l1"><a class="reference internal" href="multiple_tracebacks.html">Multiple tracebacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="friendly_tb.html">friendly tracebacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="ipython_tb.html">IPython tracebacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="jupyter_tb.html">Jupyter tracebacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="numbered_prompt.html">Numbered prompt</a></li>
<li class="toctree-l1"><a class="reference internal" href="idle_colours.html">IDLE’s colours</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Use in your project</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">Public API</a></li>
<li class="toctree-l1"><a class="reference internal" href="formatter.html">Custom formatter</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_errors.html">Registering custom error types</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugins.html">Editor plugins</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">All the tracebacks!</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tracebacks_en_3.9.html">Friendly tracebacks - Python 3.9</a></li>
<li class="toctree-l1"><a class="reference internal" href="syntax_tracebacks_en_3.9.html">SyntaxError - Python 3.9</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">En español</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tracebacks_es.html">Friendly tracebacks - en español</a></li>
<li class="toctree-l1"><a class="reference internal" href="syntax_tracebacks_es.html">Friendly SyntaxError tracebacks - en español</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">En français</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tracebacks_fr.html"> Friendly tracebacks - en Français</a></li>
<li class="toctree-l1"><a class="reference internal" href="syntax_tracebacks_fr.html"> Friendly SyntaxError tracebacks - en Français</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">בעברית</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tracebacks_he.html">Friendly tracebacks - בעברית</a></li>
<li class="toctree-l1"><a class="reference internal" href="syntax_tracebacks_he.html">Friendly SyntaxError tracebacks - בעברית</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">In italiano</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tracebacks_it.html">Friendly tracebacks - in italiano</a></li>
<li class="toctree-l1"><a class="reference internal" href="syntax_tracebacks_it.html">Friendly SyntaxError tracebacks - in italiano</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">More tracebacks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="known.html">Generic information about various exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracebacks_en_3.6.html">Friendly tracebacks - Python 3.6 in English</a></li>
<li class="toctree-l1"><a class="reference internal" href="syntax_tracebacks_en_3.6.html">SyntaxError - Python 3.6 in English</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracebacks_en_3.7.html">Friendly tracebacks - Python 3.7 in English</a></li>
<li class="toctree-l1"><a class="reference internal" href="syntax_tracebacks_en_3.7.html">SyntaxError - Python 3.7 in English</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracebacks_en_3.8.html">Friendly tracebacks - Python 3.8 in English</a></li>
<li class="toctree-l1"><a class="reference internal" href="syntax_tracebacks_en_3.8.html">SyntaxError - Python 3.8 in English</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracebacks_en_3.10.html">Friendly tracebacks - Python 3.10 in English</a></li>
<li class="toctree-l1"><a class="reference internal" href="syntax_tracebacks_en_3.10.html">SyntaxError - Python 3.10 in English</a></li>
<li class="toctree-l1"><a class="reference internal" href="tracebacks_en_3.11.html">Friendly tracebacks - Python 3.11 in English</a></li>
<li class="toctree-l1"><a class="reference internal" href="syntax_tracebacks_en_3.11.html">SyntaxError - Python 3.11 in English</a></li>
<li class="toctree-l1"><a class="reference internal" href="compare_exceptions.html">Comparing Exception messages between Python versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="compare.html">Comparison between Python versions: SyntaxErrors</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contribute</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="suggest.html">Suggest an addition</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Notes on translations - using gettext</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="notes-on-translations-using-gettext">
<h1>Notes on translations - using gettext<a class="headerlink" href="#notes-on-translations-using-gettext" title="Permalink to this headline">¶</a></h1>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>There are many sites that explain how to use gettext. However, I found
that, no matter what individual explanation I read, it was either
incomplete, too specific, or otherwise glossing over some minor point
that was important for my project.</p>
<p>I wrote these notes mostly for myself, but they may be useful for
you as well, perhaps even more so if you read a “standard” tutorial
on using gettext first.</p>
</div>
<section id="what-is-gettext">
<h2>What is gettext?<a class="headerlink" href="#what-is-gettext" title="Permalink to this headline">¶</a></h2>
<p>gettext is basically a standardized way of internationalization (i18n)
and localization (l10n) of computer programs.</p>
<p>What this means for this project, is the translation of strings shown
to the user in their preferred language.</p>
</section>
<section id="structure-of-this-project">
<h2>Structure of this project<a class="headerlink" href="#structure-of-this-project" title="Permalink to this headline">¶</a></h2>
<p>Below, I make references to various files. Here’s a simplified view of the
directory structure of this project, showing only a few relevant files:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>friendly/
    demos/
    friendly/
        locales/
            fr/
                LC_MESSAGES/
                    friendly.mo
                    friendly.po
            friendly.pot
        __init__.py
        ...
        make_pot.bat  &lt;-- not in repository
        my_gettext.py
        ...
    tests/
    setup.py
</pre></div>
</div>
<p>If you look at the repository on Github (or cloned locally), you will not
see the file <code class="docutils literal notranslate"><span class="pre">make_pot.bat</span></code>.
I’ll explain its role below.</p>
</section>
<section id="how-to-use-gettext">
<h2>How to use gettext<a class="headerlink" href="#how-to-use-gettext" title="Permalink to this headline">¶</a></h2>
<p>Suppose we want to greet a user in their own language. For example,
in English we might have the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"Hello </span><span class="si">{name}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">username</span><span class="p">))</span>
</pre></div>
</div>
<p>while in French, we might have:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"Bonjour </span><span class="si">{name}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">username</span><span class="p">))</span>
</pre></div>
</div>
<p>The first thing to do would normally be to choose one of these forms as
our standard to be used as the reference for translation.
This is what I eventually chose to do for this project.
However, in the past, I have often
used a variation where words are written in the source file in uppercase
letter to make it more obvious to see if a translation is missing.</p>
<p>To indicate that a string needs to be translated, the common way is to
surround it by a function call, using <code class="docutils literal notranslate"><span class="pre">_</span></code> as the function name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span>  <span class="n">_</span><span class="p">(</span> <span class="s2">"Hello </span><span class="si">{name}</span><span class="s2">"</span> <span class="p">)</span>  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">username</span><span class="p">)</span>  <span class="p">)</span>

<span class="c1"># extra spaces above added for clarity</span>
</pre></div>
</div>
<p>Next, we need to create a “template” file for translations.
I use <code class="docutils literal notranslate"><span class="pre">pygettext.py</span></code> included as a <strong>tool</strong> with Python.
It is very likely not on the normal path where it can be found by Python.
If you don’t know where your python files are located, you can use
Python’s REPL and do the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">prefix</span><span class="p">)</span>
<span class="go">path\to\python</span>
</pre></div>
</div>
<p>You can then navigate to the directory containing the Python version
you are using and will almost certainly
find <code class="docutils literal notranslate"><span class="pre">pygettext.py</span></code> under the <code class="docutils literal notranslate"><span class="pre">tools\i18n</span></code> subdirectory.</p>
<p><code class="docutils literal notranslate"><span class="pre">pygettext</span></code> will extract all the strings surronded by <code class="docutils literal notranslate"><span class="pre">_(</span> <span class="pre">)</span></code> in the
input file you specify and create a “template” file (identified by a <code class="docutils literal notranslate"><span class="pre">.pot</span></code>
extension). To make my life easier, I simply type <code class="docutils literal notranslate"><span class="pre">make_pot</span></code> at the prompt
which executes the content of <code class="docutils literal notranslate"><span class="pre">make_pot.bat</span></code> (I’m using Windows):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">py</span> <span class="o">-</span><span class="mf">3.7</span> <span class="n">path</span>\<span class="n">to</span>\<span class="n">python</span>\<span class="n">tools</span>\<span class="n">i18n</span>\<span class="n">pygettext</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">p</span> <span class="n">locales</span> <span class="o">-</span><span class="n">d</span> <span class="n">friendly</span> <span class="o">*.</span><span class="n">py</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">make_pot.bat</span></code> is located in the same directory where the Python source files
containing strings to be translated is located.</p></li>
<li><p>I use <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">filename.py</span></code> instead of simply <code class="docutils literal notranslate"><span class="pre">filename.py</span></code> as I set my
computer default to open <code class="docutils literal notranslate"><span class="pre">.py</span></code> files with my preferred editor instead of
executing them. If you are not using Windows, you might need to use
<code class="docutils literal notranslate"><span class="pre">python3</span></code> instead of <code class="docutils literal notranslate"><span class="pre">python</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">locales</span></code> option specifies that the template file is going to be
created (or updated) in the <code class="docutils literal notranslate"><span class="pre">locales/</span></code> directory
(see above for the directory structure).</p></li>
<li><p>Using the -d flag, I specified <code class="docutils literal notranslate"><span class="pre">friendly</span></code> as the name for the template file,
<code class="docutils literal notranslate"><span class="pre">friendly.pot</span></code>, instead of the default <code class="docutils literal notranslate"><span class="pre">messages.pot</span></code>.</p></li>
<li><p>The source files scanned by pygettext (<code class="docutils literal notranslate"><span class="pre">*.py</span></code>) will be all the
Python files in that directory.</p></li>
</ul>
<p>There’s more to be done; let’s break this up into a few additional
sections.</p>
</section>
<section id="using-poedit">
<h2>Using Poedit<a class="headerlink" href="#using-poedit" title="Permalink to this headline">¶</a></h2>
<p>In principle, template files can be edited with any standard text editor
to create “portable object” (<code class="docutils literal notranslate"><span class="pre">.po</span></code>) files from a template file.
However, this is more easily done using
<a class="reference external" href="https://poedit.net/">Poedit</a> which is a free program especially designed
for this task. There is a paid “pro” version but it is really not required for
most tasks.  However, after a while, I have purchased it and found its
suggested translations usually very useful, at least as a starting point.</p>
<p>With Poedit, you have the choice of <strong>creating</strong> a new translation
either from a <code class="docutils literal notranslate"><span class="pre">.pot</span></code> file, or from a <code class="docutils literal notranslate"><span class="pre">.po</span></code> file. Open the relevant file,
choose a language, and start translating the various strings.</p>
<p>If you are <strong>updating</strong> an existing translation, open the <code class="docutils literal notranslate"><span class="pre">.po</span></code> file
and use Poedit’s “Catalog” menu (fourth at the top of the menu
bar) to first update from the source (<code class="docutils literal notranslate"><span class="pre">messages.pot</span></code>) from which the
<code class="docutils literal notranslate"><span class="pre">.po</span></code> file is derived.</p>
<p>Poedit gives the choice to translate for specific regions (e.g. fr_CA for
French used in Canada). For this project, I prefer to choose a generic
two-letter code (fr) as it is assumed to be the case in various places.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If, for a given language, you <strong>absolutely</strong> need different language
translations, specific to a region, please file an issue
first so that this can be discussed and the impact on the rest of
the code can be properly evaluated.</p>
<p>One of the goals of this project is to provide easier to understand
tracebacks than those provided by Python. These do not need to be
absolutely perfect. For example, we follow
<a class="reference external" href="https://translatewiki.net/wiki/Translating:Blockly">Blockly’s practice</a>
in not supporting <a class="reference external" href="https://translatewiki.net/wiki/Plural">plural formatting</a></p>
</div>
<p>When it comes time to save the <code class="docutils literal notranslate"><span class="pre">.po</span></code> file, use a similar structure
as that shown above and save
it in the <code class="docutils literal notranslate"><span class="pre">LC_MESSAGES</span></code> directory of the appropriate language.
Note that Poedit will automatically save another file with
a <code class="docutils literal notranslate"><span class="pre">.mo</span></code> extension; this is a “machine object” (binary) file that will actually
be used by your program.</p>
<p>In addition to strings to be translated, <code class="docutils literal notranslate"><span class="pre">.po</span></code> files contain some
information about who translated the file and some copyright information.
In general, you might want to fill in the appropriate information.
Note that Poedit allows you to set your personal information (name
and email address) which will be automatically used, so that you don’t
have to edit the created file by hand.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Please, do not contribute translations to friendly
where you attribute the copyright to yourself.
Either do not include any copyright information
or attribute it to the friendly project.</p>
</div>
</section>
<section id="telling-python-to-use-the-translations">
<h2>Telling Python to use the translations<a class="headerlink" href="#telling-python-to-use-the-translations" title="Permalink to this headline">¶</a></h2>
<p>In this project, the language selection is done in the file <code class="docutils literal notranslate"><span class="pre">session.py</span></code>.
(See directory structure above.)
At the top of <code class="docutils literal notranslate"><span class="pre">session.py</span></code>, <code class="docutils literal notranslate"><span class="pre">my_gettext</span></code> is imported.
As I am writing this documentation, this is the content of <code class="docutils literal notranslate"><span class="pre">my_gettext.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gettext</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">class</span> <span class="nc">LangState</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">translate</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lang</span> <span class="o">=</span> <span class="s2">"en"</span>

    <span class="k">def</span> <span class="nf">install</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""Sets the language to be used for translations"""</span>
        <span class="k">if</span> <span class="n">lang</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lang</span> <span class="o">=</span> <span class="s2">"en"</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># We first look for the exact language requested.</span>
            <span class="n">_lang</span> <span class="o">=</span> <span class="n">gettext</span><span class="o">.</span><span class="n">translation</span><span class="p">(</span>
                <span class="s2">"friendly"</span><span class="p">,</span>
                <span class="n">localedir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span>  <span class="c1"># 1</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s2">"locales"</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="n">languages</span><span class="o">=</span><span class="p">[</span><span class="n">lang</span><span class="p">],</span>
                <span class="n">fallback</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># 2</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="c1"># If it is not available, we make it possible to replace a</span>
            <span class="c1"># language specific to a region, as in fr_CA, by a more</span>
            <span class="c1"># generic version, such as fr, defined by a two-letter code.</span>
            <span class="n">lang</span> <span class="o">=</span> <span class="n">lang</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># 3</span>
            <span class="n">_lang</span> <span class="o">=</span> <span class="n">gettext</span><span class="o">.</span><span class="n">translation</span><span class="p">(</span>
                <span class="s2">"friendly"</span><span class="p">,</span>
                <span class="n">localedir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s2">"locales"</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="n">languages</span><span class="o">=</span><span class="p">[</span><span class="n">lang</span><span class="p">],</span>
                <span class="n">fallback</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># 4 This means that the hard-coded strings in</span>
                <span class="c1"># the source file will be used if the requested language</span>
                <span class="c1"># is not available.</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lang</span> <span class="o">=</span> <span class="n">lang</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">translate</span> <span class="o">=</span> <span class="n">_lang</span><span class="o">.</span><span class="n">gettext</span>


<span class="n">current_lang</span> <span class="o">=</span> <span class="n">LangState</span><span class="p">()</span>  <span class="c1"># 3</span>
</pre></div>
</div>
<p>Here is an explanation for the numbered comments above:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>“Foolproof” way of locating the translation directory</p></li>
<li><p>By default, fallback is <code class="docutils literal notranslate"><span class="pre">False</span></code>; for clarity, we explicitly set it.
If a request is made to use a non-existing translation, an exception is raised.</p></li>
<li><p>This is the instance we use elsewhere; see below.</p></li>
</ol>
</div></blockquote>
<p>When we want to make use of translations inside a given function,
we do the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">my_gettext</span>

<span class="k">def</span> <span class="nf">international_greeting</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">current_lang</span><span class="o">.</span><span class="n">translate</span>
    <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s2">"Hello </span><span class="si">{name}</span><span class="s2">"</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Every language has its own way to deal (or not) with plural forms of words.
As mentioned, in principle, <code class="docutils literal notranslate"><span class="pre">gettext</span></code> offers a way to handle
with the language specific complexities.
In practice for this project, we assume a single form to be used.</p>
</div>
</section>
<section id="why-are-mo-files-in-the-repository">
<h2>Why are .mo files in the repository<a class="headerlink" href="#why-are-mo-files-in-the-repository" title="Permalink to this headline">¶</a></h2>
<p>When configuring the project, the automatically generated <code class="docutils literal notranslate"><span class="pre">.gitignore</span></code> file
include exclusion for <code class="docutils literal notranslate"><span class="pre">.pot</span></code> and <code class="docutils literal notranslate"><span class="pre">.mo</span></code> files.
The rationale is that these files are automatically generated (by some standard
programs) and it is generally suggested that such files not be included.</p>
<p>However, in this case, we want these files to be available to end users.
If someone clones the project, and needs to upload a version somewhere (e.g. pypi.org),
these generated files (at least the <code class="docutils literal notranslate"><span class="pre">.mo</span></code> files) need to be included.</p>
</section>
<section id="packaging">
<h2>Packaging<a class="headerlink" href="#packaging" title="Permalink to this headline">¶</a></h2>
<p>This is more of a “note to self” than something needed for this project.
Since <code class="docutils literal notranslate"><span class="pre">.po</span></code> and <code class="docutils literal notranslate"><span class="pre">.mo</span></code> are data files are not python files,
they are not automatically added when creating a package with setuptools.
One way to include them is to write the following in a file named
<code class="docutils literal notranslate"><span class="pre">manifest.in</span></code> written where <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> is found:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>recursive-include friendly/locales *.*
</pre></div>
</div>
<p>Also (instead?), if using a <code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code> file, include the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[options.package_data]
* =
    friendly/locales/*
</pre></div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          <a class="prev-page" href="suggest.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Suggest an addition</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; André Roberge |
          Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
          <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            | <a class="muted-link" href="_sources/translation_notes.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Notes on translations - using gettext</a><ul>
<li><a class="reference internal" href="#what-is-gettext">What is gettext?</a></li>
<li><a class="reference internal" href="#structure-of-this-project">Structure of this project</a></li>
<li><a class="reference internal" href="#how-to-use-gettext">How to use gettext</a></li>
<li><a class="reference internal" href="#using-poedit">Using Poedit</a></li>
<li><a class="reference internal" href="#telling-python-to-use-the-translations">Telling Python to use the translations</a></li>
<li><a class="reference internal" href="#why-are-mo-files-in-the-repository">Why are .mo files in the repository</a></li>
<li><a class="reference internal" href="#packaging">Packaging</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/scripts/furo.js"></script>
    <script src="_static/tabs.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    </body>
</html>